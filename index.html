<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GPS Enable Notifier</title>
  <style>
    :root { --bg:#0b1220; --fg:#e7ecf3; --muted:#8fa3b8; --accent:#4f8cff; --warn:#ffb020; --err:#ff6b6b; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--fg); }
    header { padding: 16px; border-bottom: 1px solid #1b2638; }
    main { padding: 24px; max-width: 800px; margin: 0 auto; }
    button { cursor: pointer; background: var(--accent); color: #fff; border: 0; padding: 10px 14px; border-radius: 10px; font-weight: 600; }
    button.secondary { background: transparent; color: var(--fg); border: 1px solid #2a3a55; }

    /* Banner */
    .gps-banner { position: fixed; left: 0; right: 0; bottom: 0; display: none; gap: 12px; align-items: start; padding: 14px 16px; background: #0f1729; border-top: 1px solid #22304a; box-shadow: 0 -6px 18px rgba(0,0,0,.35); }
    .gps-banner.show { display: grid; grid-template-columns: 1fr auto; }
    .gps-msg { font-size: 14px; line-height: 1.4; }
    .gps-msg strong { color: var(--warn); }
    .gps-actions { display: flex; gap: 8px; }
    .code { font-family: ui-monospace, Menlo, Consolas, monospace; background: #0b1425; padding: 2px 6px; border-radius: 6px; border: 1px solid #20304b; }
    .hint { color: var(--muted); font-size: 13px; margin-top: 10px; }
    .status { margin-top: 16px; padding: 12px; border: 1px solid #21324f; background: #0c1628; border-radius: 12px; font-size: 14px; }
    .ok { color: #7ee787; }
    .bad { color: var(--err); }
  </style>
</head>
<body>
  <header>
    <h1>Location Access Demo</h1>
  </header>
  <main>
    <p>This page tries to get your location. If it's blocked or your device location is off, you'll see a banner with steps to enable it.</p>

    <div style="display:flex; gap:10px; flex-wrap: wrap;">
      <button id="btn-request">Request Location</button>
      <button class="secondary" id="btn-check">Check Permission Only</button>
    </div>

    <div class="status" id="status">Status: <em>idle</em></div>

    <p class="hint">Note: Browsers only allow location on <span class="code">https://</span> or <span class="code">localhost</span>. You cannot auto-enable GPS programmatically; the user must allow it.</p>
  </main>

  <!-- Enable GPS banner -->
  <div id="gps-banner" class="gps-banner" role="region" aria-live="polite">
    <div class="gps-msg" id="gps-msg">
      <strong>Enable location</strong> to continue. Open your device location (GPS) and allow location permission for this site.
      <div class="hint" id="gps-hint"></div>
    </div>
    <div class="gps-actions">
      <button id="btn-try-again">Try Again</button>
      <button class="secondary" id="btn-dismiss">Dismiss</button>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const banner = document.getElementById('gps-banner');
    const msg = document.getElementById('gps-msg');
    const hint = document.getElementById('gps-hint');

    function setStatus(html) { statusEl.innerHTML = html; }
    function showBanner(reasonText, tipsHtml) {
      msg.querySelector('strong').textContent = reasonText || 'Enable location';
      hint.innerHTML = tipsHtml || '';
      banner.classList.add('show');
    }
    function hideBanner() { banner.classList.remove('show'); }

    function isSecure() { return location.protocol === 'https:' || location.hostname === 'localhost'; }

    function browserHints() {
      const ua = navigator.userAgent; // lightweight UA-based hints
      if (/Android/i.test(ua) && /Chrome\//i.test(ua)) {
        return `On Android Chrome: tap the lock icon in the address bar → <span class="code">Permissions</span> → <span class="code">Location</span> → <span class="code">Allow</span>. Also ensure device Location is ON in Quick Settings.`;
      }
      if (/iPhone|iPad|iPod/i.test(ua)) {
        return `On iOS Safari: Settings → Safari → Location → <span class="code">Ask</span>/<span class="code">Allow</span>. Also Settings → Privacy & Security → Location Services → <span class="code">On</span>.`;
      }
      if (/Firefox/i.test(ua)) {
        return `In Firefox: click the permission icon (left of the URL) → <span class="code">Permissions</span> → <span class="code">Allow Location</span>.`;
      }
      if (/Edg\//i.test(ua)) {
        return `In Microsoft Edge: click the lock icon → <span class="code">Permissions for this site</span> → <span class="code">Location</span> → <span class="code">Allow</span>.`;
      }
      return `Use the lock icon near the address bar → Site settings → <span class="code">Location</span> → <span class="code">Allow</span>. Also turn on device Location (GPS).`;
    }

    async function checkPermission() {
      if (!('permissions' in navigator) || !navigator.permissions.query) return null;
      try {
        const p = await navigator.permissions.query({ name: 'geolocation' });
        p.onchange = () => setStatus(`Permission state changed to <strong>${p.state}</strong>.`);
        return p.state; // 'granted' | 'denied' | 'prompt'
      } catch { return null; }
    }

    function getPosition(opts = {}) {
      return new Promise((resolve, reject) => {
        if (!('geolocation' in navigator)) {
          reject(new Error('Geolocation is not supported in this browser.'));
          return;
        }
        navigator.geolocation.getCurrentPosition(resolve, reject, {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0,
          ...opts,
        });
      });
    }

    async function requestLocationFlow({ silent = false } = {}) {
      if (!isSecure()) {
        showBanner('Use HTTPS to enable location', 'Location only works on <span class="code">https://</span> or <span class="code">localhost</span>.');
        setStatus('Status: <span class="bad">Insecure context</span> — use HTTPS.');
        return;
      }

      const perm = await checkPermission();
      if (perm) setStatus(`Permission: <strong>${perm}</strong>`);

      try {
        const pos = await getPosition();
        const { latitude, longitude, accuracy } = pos.coords;
        hideBanner();
        setStatus(`✔ <span class="ok">Got position</span>: <strong>${latitude.toFixed(6)}, ${longitude.toFixed(6)}</strong> (±${Math.round(accuracy)}m)`);
      } catch (err) {
        console.warn('Geolocation error', err);
        let tips = browserHints();
        let title = 'Enable location';
        if (err && err.code !== undefined) {
          // GeolocationPositionError codes: 1=PERMISSION_DENIED, 2=POSITION_UNAVAILABLE, 3=TIMEOUT
          if (err.code === 1) {
            title = 'Allow location permission';
            tips += '<br/>If previously blocked, clear the block in site permissions and try again.';
          } else if (err.code === 2) {
            title = 'Turn on device location (GPS)';
            tips += '<br/>Location may be off or unavailable indoors. Move near a window or enable GPS/Location Services.';
          } else if (err.code === 3) {
            title = 'Location timed out';
            tips += '<br/>Try again from an open area or check your connection.';
          }
        }
        if (!silent) showBanner(title, tips);
        setStatus(`Status: <span class="bad">${title}</span>. ${err?.message || ''}`);
      }
    }

    document.getElementById('btn-request').addEventListener('click', () => requestLocationFlow());
    document.getElementById('btn-check').addEventListener('click', async () => {
      const p = await checkPermission();
      setStatus(`Permission: <strong>${p ?? 'unknown (Permissions API unsupported)'}</strong>`);
    });
    document.getElementById('btn-try-again').addEventListener('click', () => requestLocationFlow({ silent: true }));
    document.getElementById('btn-dismiss').addEventListener('click', hideBanner);

    // Optional: attempt on load (comment out if you want manual only)
    // requestLocationFlow({ silent: true });
  </script>
</body>
</html>